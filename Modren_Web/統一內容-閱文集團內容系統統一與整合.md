[⬅ Modern Web 2017](https://hackmd.io/KwFgRsAMAcCMCmBaaA2AnAJkeFlEEMMMBmZdAMzDRTHMkliA?view)
# 統一內容-閱文集團內容系統統一與整合

###### tags: `ModernWeb2017`

[投影片](http://s.itho.me/modernweb/2017/day2/201-3-%E5%A4%A7%E5%98%B4.pdf)

## 閱文集團歷史
- 騰訊文學：Java+MySQL
- 創世：？
- ？


## 業務考驗
* 書: X百萬自產權＋X百萬合作商
* 章節: X億＋X億




* 另：書封+作家頭像+內容插圖


## 選型列表
* 應用程序：Java開發框架(自幹)
* 對列服務：完成雙向訊息通知和業務處理(自幹)
* 調度服務：完成定時計算(自幹)
* DFS分布內容儲存、儲存章節、圖片、音樂、影片
* mySQL主從
* Aura：圖片裁切web服務，目前JNI技術試驗階段，後期全部用C

### DFS-需求
* 橫向擴展
* 自動化
* 性能最大化：無Slavw
* 數據一致
* [支持頻繁修改]
* 支持小文件、大文件
### DFS-選型
* Fastdfs：
    * chunkfile版本控制不太好
    * group為鏡像
* CFS(騰訊內部)
* 剩下的：redis、mongodb
### DFS-核心算法 [申請專利中]
- 線程的邏輯分層
- 線程調度算法(無鎖編程算法)
### DFS-文件儲存

### Aura-DFS的訪問

## 數據路由
### 數據路由實現
- 需求
    * 盡可能小、盡可能快(?)
- 算法
    * snowflake算法-twitter(人類看不懂，並不友善)
    * id算法
- 模型
    * DTC模型(Github上有開源)

### 數據路由策略
- 數據聚合問題，比如SQL的JOIN
    * Slor等搜尋引擎解決
- 數據越大，數據的遷移問題
    * 根據業務，設計一種不需要遷移數據的
    * 實在沒辦法，使用二元搜尋樹遷移數據方法

## 任務調度
- 任務調度
    - V1-quartz實現(排程)
        * 由多線程模型改多進程模型
        * 數據庫依賴太嚴重，特別是不可併發job
        * 二次開發難度太高，代碼一坨一坨的
    - 任務調度V2-用Ｃ自主實現(猶豫要不要開源)
        * 性能是zookeeper的5~10倍()
- 任務調度器













